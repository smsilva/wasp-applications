extraObjects:
  - apiVersion: external-secrets.io/v1alpha1
    kind: ExternalSecret
    metadata:
      name: argocd-secret
    spec:
      refreshInterval: 1h
      secretStoreRef:
        kind: ClusterSecretStore
        name: azure-subscription-key-vault
      target:
        name: argocd-secret
        creationPolicy: Merge
      data:
        - secretKey: "oidc.azuread.clientSecret"
          remoteRef:
            key: secret/argocd-oidc-azuread-client-secret

  - apiVersion: external-secrets.io/v1alpha1
    kind: ExternalSecret
    metadata:
      name: argocd-ssh-auth
    spec:
      refreshInterval: 1h
      secretStoreRef:
        kind: ClusterSecretStore
        name: azure-subscription-key-vault
    
      target:
        name: argocd-ssh-auth
        creationPolicy: Owner
        template:
          type: kubernetes.io/ssh-auth
          data:
            ssh-privatekey: |
              {{`{{ .idrsabase64filecontent | base64decode | toString }}`}}
    
      data:
      - secretKey: "idrsabase64filecontent"
        remoteRef:
          key: secret/git-ssh-private-key-file-contents-base64-encoded

  - apiVersion: external-secrets.io/v1alpha1
    kind: ExternalSecret
    metadata:
      name: argocd-repo-creds
    spec:
      refreshInterval: 1h
      secretStoreRef:
        kind: ClusterSecretStore
        name: azure-subscription-key-vault
    
      target:
        name: argocd-repo-creds
        creationPolicy: Owner
        template:
          metadata:
            annotations:
              managed-by: argocd.argoproj.io
            labels:
              argocd.argoproj.io/secret-type: repo-creds
          type: Opaque
          data:
            sshPrivateKey: |
              {{`{{ .idrsabase64filecontent | base64decode | toString }}`}}
            url: |
              {{`{{ .privaterepourl | toString }}`}}
    
      data:
        - secretKey: "idrsabase64filecontent"
          remoteRef:
            key: secret/git-ssh-private-key-file-contents-base64-encoded
    
        - secretKey: "privaterepourl"
          remoteRef:
            key: secret/git-ssh-private-repo-url-github-smsilva-wasp-gitops
